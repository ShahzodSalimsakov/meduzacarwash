---
import { changeLanguage } from "i18next";
import Button from "../components/Button.astro";
import Layout from "../layouts/Layout.astro";
import i18next, { t } from "i18next";
import CalendarComponent from "../components/CalendarComponent";
import Title from "../components/Title.astro";
import MapComponent from "../components/MapComponent";
import WashTypeComponent from "../components/WashTypeComponent";

const response = await fetch("https://api.meduza-carwash.uz/graphql", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    query: `
      query {
          publicCategories {
              id
              name
              products_product_categories {
                  id
                  name
                  price
              }
          }
      }
    `,
  }),
});

const json = await response.json();
const data = json.data;

const productCategories = data["publicCategories"];

changeLanguage("ru");
---

<Layout title="Main">
  <Title>{t("main.specifyDateAndTime")}</Title>
  <CalendarComponent client:load />
  <Title>{t("main.specifyALocation")}</Title>
  <Button>{t("main.determineLocation")}</Button>
  <MapComponent client:load />
  <Title>{t("main.specifyTypeOfSink")}</Title>
  <WashTypeComponent categories={productCategories} client:load />
</Layout>
